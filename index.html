<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Open in Google Play</title>
        <style>
            body {
                font-family:
                    system-ui,
                    -apple-system,
                    Segoe UI,
                    Roboto,
                    Helvetica,
                    Arial,
                    sans-serif;
                margin: 0;
                padding: 24px;
                line-height: 1.4;
            }
            .card {
                max-width: 720px;
                margin: 0 auto;
                padding: 20px;
                border: 1px solid #e5e7eb;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            }
            h1 {
                font-size: 20px;
                margin: 0 0 12px;
            }
            .btn {
                display: inline-block;
                padding: 12px 16px;
                border-radius: 10px;
                border: 0;
                background: #0ea5e9;
                color: #fff;
                text-decoration: none;
                font-weight: 600;
            }
            .btn:active {
                transform: translateY(1px);
            }
            code {
                background: #f6f8fa;
                padding: 2px 6px;
                border-radius: 6px;
            }
            .muted {
                color: #6b7280;
                font-size: 14px;
            }
            .row {
                margin: 14px 0;
            }
            .mono {
                font-family:
                    ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
                font-size: 12px;
            }
            .small {
                font-size: 12px;
            }
            .ok {
                color: #16a34a;
            }
            .warn {
                color: #b45309;
            }
        </style>
    </head>
    <body>
        <div class="card">
            <h1>Opening Google Play…</h1>
            <p class="muted">
                If nothing happens in a second, tap the button below.
            </p>

            <div class="row">
                <a id="openPlayBtn" class="btn" href="#">Open in Play Store</a>
            </div>

            <div id="debug" class="row small mono" style="display: none"></div>

            <div class="row small muted">
                <div>
                    <strong>Status:</strong> <span id="status">init</span>
                </div>
            </div>

            <div class="row small muted">
                <details>
                    <summary>Fallback</summary>
                    <div>
                        Web Play URL (fallback): <a id="webUrl" href="#"></a>
                    </div>
                </details>
            </div>
        </div>

        <script>
            const PKG_ID = "com.routethis.giant";
            const REFERRER_RAW =
                "https://beyondbroadband.app.routethis.com/dl/self-install?apiKey=b820b9d2-c60d-4d28-a154-234b5a57deb9&userId=b7c8d0a8-6228-44ee-bb39-4a11011eb698&username=2VP38VJE";

            // URL-encoded once for referrer param
            const REFERRER_ENC = encodeURIComponent(REFERRER_RAW);

            // Build the market and web URLs
            const marketUrl = `market://details?id=${PKG_ID}&referrer=${REFERRER_ENC}`;
            const webUrl = `https://play.google.com/store/apps/details?id=${PKG_ID}&referrer=${REFERRER_ENC}`;

            const isAndroid = /Android/i.test(navigator.userAgent);
            const isDebug = new URLSearchParams(location.search).has("debug");

            const statusEl = document.getElementById("status");
            const btn = document.getElementById("openPlayBtn");
            const dbg = document.getElementById("debug");
            const webEl = document.getElementById("webUrl");

            // Set hrefs
            btn.href = marketUrl;
            webEl.href = webUrl;
            webEl.textContent = webUrl;

            function setStatus(s) {
                statusEl.textContent = s;
            }

            function tryOpenMarket() {
                setStatus("trying market://…");
                // Some browsers require a user gesture; simulate by clicking the anchor.
                btn.click();
                // Fallback to web Play after 1200ms if we are still here.
                setTimeout(() => {
                    setStatus("fallback to web play");
                    location.href = webUrl;
                }, 1200);
            }

            function showDebug() {
                dbg.style.display = "block";
                dbg.innerText = [
                    `UA: ${navigator.userAgent}`,
                    `Android: ${isAndroid}`,
                    `marketUrl: ${marketUrl}`,
                    `webUrl: ${webUrl}`,
                ].join("\n");
            }

            // Wire button (in case auto attempt is blocked)
            btn.addEventListener("click", (e) => {
                // Allow default navigation to proceed
                setStatus("user tapped market link");
            });

            if (isDebug) showDebug();

            // Auto-attempt only on Android; other platforms keep the button visible
            if (isAndroid && !isDebug) {
                // Give DOM a beat, then try to open Play app immediately
                setTimeout(tryOpenMarket, 50);
            } else {
                setStatus("waiting for user");
            }
        </script>
    </body>
</html>
